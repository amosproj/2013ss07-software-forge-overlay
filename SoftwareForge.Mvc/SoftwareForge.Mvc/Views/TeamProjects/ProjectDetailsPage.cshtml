<!-- 
 - Copyright (c) 2013 by Denis Bach, Marvin Kampf, Konstantin Tsysin, Taner Tunc, Florian Wittmann
 -
 - This file is part of the Software Forge Overlay rating application.
 -
 - This program is free software: you can redistribute it and/or modify
 - it under the terms of the GNU Affero General Public License as
 - published by the Free Software Foundation, either version 3 of the
 - License, or (at your option) any later version.
 -
 - This program is distributed in the hope that it will be useful, 
 - but WITHOUT ANY WARRANTY; without even the implied warranty of
 - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 - GNU Affero General Public License for more details.
 -
 - You should have received a copy of the GNU Affero General Public
 - License along with this program. If not, see
 - <http://www.gnu.org/licenses/>.
 -->

@using SoftwareForge.Common.Models
@model Project
<p>
    <b>@Model.Name</b> @Html.ActionLink("[Rename]", "RenameProjectPage", "TeamProjects",new {guid=Model.Guid},null)<br/>
    TFS-Project: @Model.TfsName

    <br/>
    @Model.Description<br/>
    <i>@Model.ProjectType</i><br/>
    

    
    @if (@Model.Users.Any(t => t.User.Username.Equals(User.Identity.Name)))
    {
        
        if (@Model.Users.Any(t => (t.User.Username.Equals(User.Identity.Name)) && (t.UserRole == UserRole.Contributor)))
         {
             @Html.ActionLink("[Leave as Contributor]", "LeaveProject", "TeamProjects", new {projectGuid = Model.Guid, username = User.Identity.Name, role = UserRole.Contributor}, null)
         }
         else if (@Model.Users.Any(t => (t.User.Username.Equals(User.Identity.Name)) && (t.UserRole == UserRole.ProjectOwner)))
         {
             if ((@Model.Users.Where(u => (u.UserRole == UserRole.ProjectOwner))).Count() > 1)
             {
                 @Html.ActionLink("[Leave as Owner]", "LeaveProject", "TeamProjects", new {projectGuid = Model.Guid, username = User.Identity.Name, role = UserRole.ProjectOwner}, null)
             }


         }
         else
         {
             @Html.ActionLink("[Unwatch]", "UnwatchProject", "TeamProjects", new {guid = Model.Guid, username = User.Identity.Name}, null)
         }
    }
    else
        {
            @Html.ActionLink("[Watch]", "WatchProject", "TeamProjects", new {guid = Model.Guid, username = User.Identity.Name}, null)
        }
    

    @{
        ProjectMember user = Model.Users.SingleOrDefault(u => u.User.Username == User.Identity.Name);
        if ((user == null) || user.UserRole != UserRole.ProjectOwner)
        {
            @Html.ActionLink("[Create join request]", "CreateProjectJoinRequest", "TeamProjects", new {guid = Model.Guid}, null)
        }
    }

    <br/>
    <b>ProjectOwner:</b>
    <ul>
        @foreach (ProjectMember projectMember in Model.Users.Where(t=>t.UserRole == UserRole.ProjectOwner))
        {
            <li>@projectMember.User.Username</li>
        }
    </ul>

    <b>Contributor:</b>
    <ul>
    @foreach (ProjectMember projectMember in Model.Users.Where(t=>t.UserRole == UserRole.Contributor))
    {
        <li>@projectMember.User.Username</li>
    }
    </ul>
</p>
